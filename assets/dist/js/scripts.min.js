class WheelOfFortune{constructor(t){this.canvas=t.canvas,this.ctx=this.canvas.getContext("2d"),this.center=this.canvas.width/2,this.radius=this.center,this.sections=t.sections||[],this.ajaxUrl=t.ajaxUrl,this.nonce=t.nonce,this.resultEl=t.resultEl,this.phone=t.phone||"",this.anglePerSection=2*Math.PI/this.sections.length,this.currentAngle=0,this.spinning=!1,this.continuousSpinId=null,this.pointerDistance=50,this.pointerSize=28,this.init()}init(){this.drawWheel(),this.spinBtn&&this.spinBtn.addEventListener("click",()=>this.handleSpin())}setSpinButton(t){this.spinBtn=t,this.spinBtn.addEventListener("click",()=>this.handleSpin())}drawWheel(){let s=this.ctx,a=this.center,r=this.radius;s.clearRect(0,0,this.canvas.width,this.canvas.height),this.sections.forEach((t,e)=>{var i=this.currentAngle+e*this.anglePerSection-Math.PI/2,n=i+this.anglePerSection,i=(s.beginPath(),s.moveTo(a,a),s.arc(a,a,r,i,n),e%2==0?"#fff":"rgba(104, 91, 199, 1)");s.fillStyle=i,s.fill()}),s.lineWidth=25,s.strokeStyle="rgba(238, 66, 133, 1)",s.beginPath(),s.arc(a,a,r,0,2*Math.PI),s.stroke(),this.sections.forEach((t,e)=>{var i=this.currentAngle+e*this.anglePerSection-Math.PI/2;s.save(),s.translate(a,a),s.rotate(i+this.anglePerSection/2),s.textAlign="center",s.textBaseline="middle",s.font="700 12.71px Rubik, sans-serif",s.fillStyle=e%2==0?"rgba(104, 91, 199, 1)":"#fff",s.fillText(t.label.toUpperCase(),r/2,0),s.restore()}),s.beginPath(),s.arc(a,a,50,0,2*Math.PI),s.fillStyle="#fff",s.fill(),s.lineWidth=11,s.strokeStyle="rgba(238, 66, 133, 1)",s.stroke(),s.beginPath(),s.moveTo(a+this.pointerDistance,a-this.pointerSize/2),s.lineTo(a+this.pointerDistance+this.pointerSize,a),s.lineTo(a+this.pointerDistance,a+this.pointerSize/2),s.closePath(),s.fillStyle="rgba(238, 66, 133, 1)",s.fill()}handleSpin(){this.spinning||(this.spinning=!0,this.startContinuousSpin(),fetch(this.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"wof_spin",nonce:this.nonce,phone:this.phone})}).then(t=>t.json()).then(t=>{if(!t.success)throw new Error(t.data?.message||"Spin failed");let e=t.data.result;t=this.sections.findIndex(t=>t.id===e);if(-1===t)throw new Error("Invalid prize id");this.stopContinuousSpin(),this.animateFinalSpin(t)}).catch(t=>{this.stopContinuousSpin(),this.spinning=!1,this.resultEl&&(this.resultEl.textContent=t.message||"Error occurred during spin.")}))}startContinuousSpin(){let t=this.currentAngle,e=()=>{t+=.3,this.currentAngle=t%(2*Math.PI),this.drawWheel(),this.continuousSpinId=requestAnimationFrame(e)};e()}stopContinuousSpin(){this.continuousSpinId&&(cancelAnimationFrame(this.continuousSpinId),this.continuousSpinId=null)}animateFinalSpin(i){var t=Math.PI/2-i*this.anglePerSection-this.anglePerSection/2;let n=10*Math.PI+t,s=null,a=this.currentAngle,r=t=>{var t=t-(s=s||t),t=Math.min(t/5e3,1),e=1-Math.pow(1-t,3);this.currentAngle=a+(n-a)*e,this.drawWheel(),t<1?requestAnimationFrame(r):(this.currentAngle%=2*Math.PI,this.spinning=!1,alert("ðŸŽ‰ You won: "+this.sections[i].label),"function"==typeof Cart&&"function"==typeof(e=new Cart).updateCartInformation&&e.updateCartInformation())};requestAnimationFrame(r)}}let wheel=new WheelOfFortune({canvas:document.getElementById("wheel"),sections:[{id:0,label:"Prize 0"},{id:1,label:"Prize 1"},{id:2,label:"Prize 2"},{id:3,label:"Prize 3"},{id:4,label:"Prize 4"},{id:5,label:"Prize 5"},{id:6,label:"Prize 6"},{id:7,label:"Prize 7"}],ajaxUrl:WOF_JS.ajax_url,nonce:WOF_JS.nonce,phone:"+380991231250",resultEl:document.getElementById("result")}),spinBtn=document.getElementById("spinBtn");wheel.setSpinButton(spinBtn);